k8s-minion-conf:
  image: imikushin/rancheros-k8s
  labels:
  - io.rancher.os.detach=false
  - io.rancher.os.reloadconfig=true
  - io.rancher.os.scope=system
  net: host
  links:
  - etcd
  - flannel
  - docker
  volumes_from:
  - all-volumes
  environment:
  - NODE_IP
  command: k8s-minion-conf.sh

kube-minion:
  image: gcr.io/google_containers/hyperkube:v0.16.0
  labels:
  - io.rancher.os.scope=system
  net: host
  links:
  - k8s-minion-conf
  volumes:
  - /var/run/docker.sock:/var/run/docker.sock
  environment:
  - K8S_MASTER
  - NODE_IP
  command: /hyperkube kubelet --api_servers=${K8S_MASTER} --v=2 --address=0.0.0.0 --enable_server --hostname_override=${NODE_IP}

kube-proxy:
  image: gcr.io/google_containers/hyperkube:v0.16.0
  labels:
  - io.rancher.os.scope=system
  privileged: true
  net: host
  links:
  - kube-minion
  volumes:
  - /var/run/docker.sock:/var/run/docker.sock
  environment:
  - K8S_MASTER
  command: /hyperkube proxy --master=${K8S_MASTER} --v=2
